ONTEXTO: Estou desenvolvendo um sistema de Gestão Financeira (React + Node.js + Tailwind). Tenho uma funcionalidade de "Exportar Relatório PDF com IA", mas estou enfrentando três problemas críticos que preciso que você resolva agora:

Gráficos em Branco: Meus gráficos ficam dentro de Abas (Tabs). Quando gero o PDF, os gráficos das abas ocultas saem em branco porque o html2canvas não consegue capturar elementos com display: none.

Dados da IA Faltando: O Backend às vezes devolve JSON incompleto, deixando o "Sumário Executivo" vazio no PDF.

Layout PDF Ruim: O relatório cria páginas em branco desnecessárias.

TAREFA: Quero que você reescreva os componentes necessários aplicando a "Técnica do Container de Impressão" e reforce o Backend.

INSTRUÇÕES TÉCNICAS PARA A SOLUÇÃO:

PASSO 1: Frontend - Página de Análise (ai-analysis.tsx)

Crie uma div container com estilo position: absolute; left: -9999px; top: 0; width: 1000px;. Isso a deixa invisível para o usuário, mas renderizada no DOM.

Dentro dessa div, renderize CÓPIAS de todos os componentes de gráfico (CashFlowChart, RevenueChart, ExpensesChart, DebtChart).

Dê a essas cópias IDs exclusivos com sufixo -print (ex: id="cashflow-chart-print").

Passe os mesmos dados (data={...}) que os gráficos principais recebem.

PASSO 2: Frontend - Exportador (ReportExporter.jsx)

Atualize a função captureChart para buscar primeiro pelo ID do elemento de impressão (ex: buscar cashflow-chart-print antes de cashflow-chart).

Isso garante que, mesmo se o usuário estiver na aba "DRE", o gráfico de "Fluxo de Caixa" será capturado corretamente da área oculta.

Adicione verificação condicional antes de usar pdf.addPage() para evitar páginas vazias.

Verifique se analysisResult.executive_summary existe. Se não, exiba um texto padrão "Análise em processamento...".

PASSO 3: Backend - Rota da IA (server/routes/ai.ts)

Reescreva o prompt do sistema enviado para a IA (Gemini/OpenAI).

Adicione uma instrução explícita de JSON Enforcement: "Você é um CFO Sênior. Você DEVE retornar um JSON válido. O campo 'executive_summary' é OBRIGATÓRIO e deve conter pelo menos 3 parágrafos de análise."

Garanta que a rota trate erros de parseamento JSON caso a IA falhe.

AGORA, GERE O CÓDIGO CORRIGIDO PARA:

O componente da página principal (ai-analysis.tsx) com a div oculta.

O componente ReportExporter.jsx otimizado.

A rota do backend (server/routes/ai.ts) com o prompt reforçado.